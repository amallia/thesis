\chapter{Codice sorgente}

\section{Esempio di stored procedure in Redis}

Il seguente listato mostra una stored procedure scritta in LUA che dato un insieme ordinato
\cverb|paying-users| in cui le stringhe sono gli ID degli utenti di un sistema, e il punteggio
associato è il totale speso dall'utente nell'applicazione, calcola qual è la media di spesa degli
utenti ``premium'', cioè che hanno speso più di \SI{1000}{\EUR}.

Si veda la \autoref{sec:redis:lua} per maggiori informazioni.

\sourcecode[language={[5.0]Lua}]{code/zsetaverage.lua}


\section{Calcolo dell'errore di cardinalità di un filtro di Bloom}

Il seguente listato effettua una simulazione di calcolo dell'errore di cardinalità in un filtro
di Bloom di \SI{8192}{\bit}, con $2$ funzioni di hash.

Si veda la \autoref{sec:bloomcard} per maggiori informazioni.

\sourcecode[language=Python]{code/cardinality.py}


\section{Calcolo dei parametri ottimali di un filtro di Bloom}

I seguenti listati effettuano il calcolo dei parametri ottimali per un filtro di Bloom da 64 MiB.

Si veda la \autoref{sec:bloomparms} per maggiori informazioni.

\sourcecode[language=Python]{code/bloomparms1.py}
\sourcecode[language=Python]{code/bloomparms2.py}


\section{Modifica al database Redis}
\label{sec:modredis}

I seguenti listati mostrano la parte principale della modifica al database Redis:
l'implementazione del filtro di Bloom, e i test automatizzati che verificano la correttezza
del codice. Si veda la \autoref{sec:patchexplain} per una descrizione dettagliata di questo codice.

\subsection{Implementazione dei filtri di Bloom}
\sourcecode[language=C]{code/bloom.h}
\sourcecode[language=C]{code/bloom.c}

\subsection{Test di unità}
\sourcecode[language=tcl]{code/bloom.tcl}

\subsection{Analisi dei parametri del filtro scalabile}
\sourcecode[language=Python]{code/scalingbloomparms.py}
